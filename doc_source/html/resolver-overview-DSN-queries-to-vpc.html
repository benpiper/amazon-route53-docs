<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>resolver-overview-DSN-queries-to-vpc</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
</head>
<body>
<h1 id="resolving-dns-queries-between-vpcs-and-your-network">Resolving DNS queries between VPCs and your network<a name="resolver-overview-DSN-queries-to-vpc"></a></h1>
<p>The Resolver contains endpoints that you configure to answer DNS queries to and from your on-premises environment.</p>
<p><strong>Note</strong><br />
Forwarding private DNS queries to any VPC CIDR + 2 address from your on-premises DNS servers is not supported, and can cause unstable results. Instead, we recommend that you use a Resolver inbound endpoint.</p>
<p>You also can integrate DNS resolution between Resolver and DNS resolvers on your network by configuring forwarding rules. <em>Your network</em> can include any network that is reachable from your VPC, such as the following: + The VPC itself + Another peered VPC + An on-premises network that is connected to AWS with AWS Direct Connect, a VPN, or a network address translation (NAT) gateway</p>
<p>Before you start to forward queries, you create Resolver inbound and/or outbound endpoints in the connected VPC. These endpoints provide a path for inbound or outbound queries:</p>
<p><strong>Inbound endpoint: DNS resolvers on your network can forward DNS queries to Route 53 Resolver via this endpoint</strong><br />
This allows your DNS resolvers to easily resolve domain names for AWS resources such as EC2 instances or records in a Route 53 private hosted zone. For more information, see <a href="#resolver-overview-forward-network-to-vpc">How DNS resolvers on your network forward DNS queries to Route 53 Resolver endpoints</a>.</p>
<p><strong>Outbound endpoint: Resolver conditionally forwards queries to resolvers on your network via this endpoint</strong><br />
To forward selected queries, you create Resolver rules that specify the domain names for the DNS queries that you want to forward (such as example.com), and the IP addresses of the DNS resolvers on your network that you want to forward the queries to. If a query matches multiple rules (example.com, acme.example.com), Resolver chooses the rule with the most specific match (acme.example.com) and forwards the query to the IP addresses that you specified in that rule. For more information, see <a href="#resolver-overview-forward-vpc-to-network">How Route 53 Resolver endpoint forwards DNS queries from your VPCs to your network</a>.</p>
<p>Like Amazon VPC, Resolver is regional. In each region where you have VPCs, you can choose whether to forward queries from your VPCs to your network (outbound queries), from your network to your VPCs (inbound queries), or both.</p>
<p><strong>Note</strong><br />
When you create a Resolver endpoint, you can’t specify a VPC that has the instance tenancy attribute set to <code>dedicated</code>. For more information, see <a href="#resolver-considerations-dedicated-instance-tenancy">Using Resolver in VPCs that are configured for dedicated instance tenancy</a>.</p>
<p>To use inbound or outbound forwarding, you create a Resolver endpoint in your VPC. As part of the definition of an endpoint, you specify the IP addresses that you want to forward inbound DNS queries to or the IP addresses that you want outbound queries to originate from. For each IP address that you specify, Resolver automatically creates a VPC elastic network interface.</p>
<p>The following diagram shows the path of a DNS query from a DNS resolver on your network to Route 53 Resolver endpoints.</p>
<figure>
<img src="http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/images/Resolver-inbound-endpoint.png" alt="" /><figcaption>[Conceptual graphic that shows the path of a DNS query from a DNS resolver on your network to Route 53 Resolver endpoints.]</figcaption>
</figure>
<p>The following diagram shows the path of a DNS query from an EC2 instance in one of your VPCs to a DNS resolver on your network.</p>
<figure>
<img src="http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/images/Resolver-outbound-endpoint.png" alt="" /><figcaption>[Conceptual graphic that shows the path of a DNS query from your network to Route 53 Resolver.]</figcaption>
</figure>
<p>For an overview of VPC network interfaces, see <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_ElasticNetworkInterfaces.html">Elastic network interfaces</a> in the <em>Amazon VPC User Guide</em>.</p>
<p><strong>Topics</strong> + <a href="#resolver-overview-forward-network-to-vpc">How DNS resolvers on your network forward DNS queries to Route 53 Resolver endpoints</a> + <a href="#resolver-overview-forward-vpc-to-network">How Route 53 Resolver endpoint forwards DNS queries from your VPCs to your network</a> + <a href="#resolver-choose-vpc">Considerations when creating inbound and outbound endpoints</a></p>
<h2 id="how-dns-resolvers-on-your-network-forward-dns-queries-to-route-53-resolver-endpoints">How DNS resolvers on your network forward DNS queries to Route 53 Resolver endpoints<a name="resolver-overview-forward-network-to-vpc"></a></h2>
<p>When you want to forward DNS queries from your network to Route 53 Resolver endpoints in an AWS Region, you perform the following steps:</p>
<ol type="1">
<li><p>You create a Route 53 Resolver inbound endpoint in a VPC and specify the IP addresses that the resolvers on your network forward DNS queries to.</p>
<p>For each IP address that you specify for the inbound endpoint, Resolver creates a VPC elastic network interface in the VPC where you created the inbound endpoint.</p></li>
<li><p>You configure resolvers on your network to forward DNS queries for the applicable domain names to the IP addresses that you specified in the inbound endpoint. For more information, see <a href="#resolver-choose-vpc">Considerations when creating inbound and outbound endpoints</a>.</p></li>
</ol>
<p>Here’s how Resolver resolves DNS queries that originate on your network:</p>
<ol type="1">
<li><p>A web browser or another application on your network submits a DNS query for a domain name that you forwarded to Resolver.</p></li>
<li><p>A resolver on your network forwards the query to the IP addresses in your inbound endpoint.</p></li>
<li><p>The inbound endpoint forwards the query to Resolver.</p></li>
<li><p>Resolver gets the applicable value for the domain name in the DNS query, either internally or by performing a recursive lookup against public name servers.</p></li>
<li><p>Resolver returns the value (typically an IPv4 IP address) to the inbound endpoint.</p></li>
<li><p>The inbound endpoint returns the value to the resolver on your network.</p></li>
<li><p>The resolver on your network returns the value to the application.</p></li>
<li><p>Using the value that was returned by Resolver, the application submits an HTTP request, for example, a request for an object in an Amazon S3 bucket.</p></li>
</ol>
<p>Creating an inbound endpoint doesn’t change the behavior of Resolver, it just provides a path from a location outside the AWS network to Resolver.</p>
<h2 id="how-route-53-resolver-endpoint-forwards-dns-queries-from-your-vpcs-to-your-network">How Route 53 Resolver endpoint forwards DNS queries from your VPCs to your network<a name="resolver-overview-forward-vpc-to-network"></a></h2>
<p>When you want to forward DNS queries from the EC2 instances in one or more VPCs in an AWS Region to your network, you perform the following steps.</p>
<ol type="1">
<li><p>You create a Route 53 Resolver outbound endpoint in a VPC, and you specify several values:</p>
<ul>
<li>The VPC that you want DNS queries to pass through on the way to the resolvers on your network.</li>
<li>The IP addresses in your VPC that you want Resolver to forward DNS queries from. To hosts on your network, these are the IP addresses that the DNS queries originate from.</li>
<li>A <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html">VPC security group</a></li>
</ul>
<p>For each IP address that you specify for the outbound endpoint, Resolver creates an Amazon VPC elastic network interface in the VPC that you specify. For more information, see <a href="#resolver-choose-vpc">Considerations when creating inbound and outbound endpoints</a>.</p></li>
<li><p>You create one or more rules, which specify the domain names of the DNS queries that you want Resolver to forward to resolvers on your network. You also specify the IP addresses of the resolvers. For more information, see <a href="#resolver-overview-forward-vpc-to-network-using-rules">Using rules to control which queries are forwarded to your network</a>.</p></li>
<li><p>You associate each rule with the VPCs for which you want to forward DNS queries to your network.</p></li>
</ol>
<p><strong>Topics</strong> + <a href="#resolver-overview-forward-vpc-to-network-using-rules">Using rules to control which queries are forwarded to your network</a> + <a href="#resolver-overview-forward-vpc-to-network-domain-name-matches">How Resolver determines whether the domain name in a query matches any rules</a> + <a href="#resolver-overview-forward-vpc-to-network-where-to-forward-queries">How Resolver determines where to forward DNS queries</a> + <a href="#resolver-overview-forward-vpc-to-network-using-rules-multiple-regions">Using rules in multiple Regions</a> + <a href="#resolver-overview-forward-vpc-to-network-autodefined-rules">Domain names that Resolver creates autodefined system rules for</a></p>
<h3 id="using-rules-to-control-which-queries-are-forwarded-to-your-network">Using rules to control which queries are forwarded to your network<a name="resolver-overview-forward-vpc-to-network-using-rules"></a></h3>
<p>Rules control which DNS queries Route 53 Resolver endpoint forwards to DNS resolvers on your network and which queries Resolver answers itself.</p>
<p>You can categorize rules in a couple of ways. One way is by who creates the rules: + <strong>Autodefined rules</strong> – Resolver automatically creates autodefined rules and associates the rules with your VPCs. Most of these rules apply to the AWS-specific domain names that Resolver answers queries for. For more information, see <a href="#resolver-overview-forward-vpc-to-network-autodefined-rules">Domain names that Resolver creates autodefined system rules for</a>. + <strong>Custom rules</strong> – You create custom rules and associate the rules with VPCs. Currently, you can create only one type of custom rule, conditional forwarding rules, also known as forwarding rules. Forwarding rules cause Resolver to forward DNS queries from your VPCs to the IP addresses for DNS resolvers on your network.</p>
<p>If you create a forwarding rule for the same domain as an autodefined rule, Resolver forwards queries for that domain name to DNS resolvers on your network based on the settings in the forwarding rule.</p>
<p>Another way to categorize rules is by what they do: + <strong>Conditional forwarding rules</strong> – You create conditional forwarding rules (also known as forwarding rules) when you want to forward DNS queries for specified domain names to DNS resolvers on your network. + <strong>System rules</strong> – System rules cause Resolver to selectively override the behavior that is defined in a forwarding rule. When you create a system rule, Resolver resolves DNS queries for specified subdomains that would otherwise be resolved by DNS resolvers on your network.</p>
<p>By default, forwarding rules apply to a domain name and all its subdomains. If you want to forward queries for a domain to a resolver on your network but you don’t want to forward queries for some subdomains, you create a system rule for the subdomains. For example, if you create a forwarding rule for example.com but you don’t want to forward queries for acme.example.com, you create a system rule and specify acme.example.com for the domain name. + <strong>Recursive rule</strong> – Resolver automatically creates a recursive rule named <strong>Internet Resolver</strong>. This rule causes Route 53 Resolver to act as a recursive resolver for any domain names that you didn’t create custom rules for and that Resolver didn’t create autodefined rules for. For information about how to override this behavior, see “Forwarding All Queries to Your Network” later in this topic.</p>
<p>You can create custom rules that apply to specific domain names (yours or most AWS domain names), to public AWS domains names, or to all domain names.</p>
<p><strong>Forwarding queries for specific domain names to your network</strong><br />
To forward queries for a specific domain name, such as example.com, to your network, you create a rule and specify that domain name. You also specify the IP addresses of the DNS resolvers on your network that you want to forward the queries to. You then associate each rule with the VPCs for which you want to forward DNS queries to your network. For example, you can create separate rules for example.com, example.org, and example.net. Then you can associate the rules with the VPCs in an AWS Region in any combination.</p>
<p><strong>Forwarding queries for amazonaws.com to your network</strong><br />
The domain name amazonaws.com is the public domain name for AWS resources such as EC2 instances and S3 buckets. If you want to forward queries for amazonaws.com to your network, create a rule, specify amazonaws.com for the domain name, and specify <strong>Forward</strong> for the rule type.<br />
Resolver doesn’t automatically forward DNS queries for some amazonaws.com subdomains even if you create a forwarding rule for amazonaws.com. For more information, see <a href="#resolver-overview-forward-vpc-to-network-autodefined-rules">Domain names that Resolver creates autodefined system rules for</a>. For information about how to override this behavior, see “Forwarding All Queries to Your Network,” immediately following.</p>
<p><strong>Forwarding all queries to your network</strong></p>
<p>If you want to forward all queries to your network, you create a rule, specify “.” (dot) for the domain name, and associate the rule with the VPCs for which you want to forward all DNS queries to your network. Resolver still doesn’t forward all DNS queries to your network because using a DNS resolver outside of AWS would break some functionality. For example, some internal AWS domain names have internal IP address ranges that aren’t accessible from outside of AWS. For a list of the domain names for which queries aren’t forwarded to your network when you create a rule for “.”, see <a href="#resolver-overview-forward-vpc-to-network-autodefined-rules">Domain names that Resolver creates autodefined system rules for</a>.<br />
However, autodefined system rules for reverse DNS can be disabled, allowing the “.” rule to forward all reverse DNS queries to your network. For more information on how to turn off the autodefined rules, see <a href="resolver-automatic-forwarding-rules-reverse-dns.html">Forwarding rules for reverse DNS queries in Resolver</a>.<br />
If you want to try forwarding DNS queries for all domain names to your network, including the domain names that are excluded from forwarding by default, you can create a “.” rule and do one of the following:<br />
+ Set the <code>enableDnsHostnames</code> flag for the VPC to <code>false</code> + Create rules for the domain names that are listed in <a href="#resolver-overview-forward-vpc-to-network-autodefined-rules">Domain names that Resolver creates autodefined system rules for</a> If you forward all domain names to your network, including the domain names that Resolver excludes when you create a “.” rule, some features might stop working.</p>
<h3 id="how-resolver-determines-whether-the-domain-name-in-a-query-matches-any-rules">How Resolver determines whether the domain name in a query matches any rules<a name="resolver-overview-forward-vpc-to-network-domain-name-matches"></a></h3>
<p>Route 53 Resolver compares the domain name in the DNS query with the domain name in the rules that are associated with the VPC that the query originated from. Resolver considers the domain names to match in the following cases: + The domain names match exactly + The domain name in the query is a subdomain of the domain name in the rule</p>
<p>For example, if the domain name in the rule is acme.example.com, Resolver considers the following domain names in a DNS query to be a match: + acme.example.com + zenith.acme.example.com</p>
<p>The following domain names are not a match: + example.com + nadir.example.com</p>
<p>If the domain name in a query matches the domain name in more than one rule (such as example.com and www.example.com), Resolver routes outbound DNS queries using the rule that contains the most specific domain name (www.example.com).</p>
<h3 id="how-resolver-determines-where-to-forward-dns-queries">How Resolver determines where to forward DNS queries<a name="resolver-overview-forward-vpc-to-network-where-to-forward-queries"></a></h3>
<p>When an application that runs on an EC2 instance in a VPC submits a DNS query, Route 53 Resolver performs the following steps:</p>
<ol type="1">
<li><p>Resolver checks for domain names in rules.</p>
<p>If the domain name in a query matches the domain name in a rule, Resolver forwards the query to the IP address that you specified when you created the outbound endpoint. The outbound endpoint then forwards the query to the IP addresses of resolvers on your network, which you specified when you created the rule.</p>
<p>For more information, see <a href="#resolver-overview-forward-vpc-to-network-domain-name-matches">How Resolver determines whether the domain name in a query matches any rules</a>.</p></li>
<li><p>Resolver endpoint forwards DNS queries based on the settings in the “.” rule.</p>
<p>If the domain name in a query doesn’t match the domain name in any other rules, Resolver forwards the query based on the settings in the autodefined “.” (dot) rule. The dot rule applies to all domain names except some AWS internal domain names and record names in private hosted zones. This rule causes Resolver to forward DNS queries to public name servers if the domain names in queries don’t match any names in your custom forwarding rules. If you want to forward all queries to the DNS resolvers on your network, you can create a custom forwarding rule, specify “.” for the domain name, specify <strong>Forwarding</strong> for <strong>Type</strong>, and specify the IP addresses of those resolvers.</p></li>
<li><p>Resolver returns the response to the application that submitted the query.</p></li>
</ol>
<h3 id="using-rules-in-multiple-regions">Using rules in multiple Regions<a name="resolver-overview-forward-vpc-to-network-using-rules-multiple-regions"></a></h3>
<p>Route 53 Resolver is a regional service, so objects that you create in one AWS Region are available only in that Region. To use the same rule in more than one Region, you must create the rule in each Region.</p>
<p>The AWS account that created a rule can share the rule with other AWS accounts. For more information, see <a href="resolver-rules-managing.html#resolver-rules-managing-sharing">Sharing forwarding rules with other AWS accounts and using shared rules</a>.</p>
<h3 id="domain-names-that-resolver-creates-autodefined-system-rules-for">Domain names that Resolver creates autodefined system rules for<a name="resolver-overview-forward-vpc-to-network-autodefined-rules"></a></h3>
<p>Resolver automatically creates autodefined system rules that define how queries for selected domains are resolved by default: + For private hosted zones and for Amazon EC2–specific domain names (such as compute.amazonaws.com and compute.internal), autodefined rules ensure that your private hosted zones and EC2 instances continue to resolve if you create conditional forwarding rules for less specific domain names such as “.” (dot) or “com”. + For publicly reserved domain names (such as localhost and 10.in-addr.arpa), DNS best practices recommend that queries are answered locally instead of being forwarded to public name servers. See <a href="https://tools.ietf.org/html/rfc6303">RFC 6303, Locally Served DNS Zones</a>.</p>
<p><strong>Note</strong><br />
If you create a conditional forwarding rule for “.” (dot) or “com”, we recommend that you also create a system rule for amazonaws.com. (System rules cause Resolver to locally resolve DNS queries for specific domains and subdomains.) Creating this system rule improves performance, reduces the number of queries that are forwarded to your network, and reduces Resolver charges.</p>
<p>If you want to override an autodefined rule, you can create a conditional forwarding rule for the same domain name.</p>
<p>You can also disable the autodefined rules. For more information, see <a href="resolver-automatic-forwarding-rules-reverse-dns.html">Forwarding rules for reverse DNS queries in Resolver</a>.</p>
<p>Resolver creates the following autodefined rules.</p>
<p><strong>Rules for private hosted zones</strong><br />
For each private hosted zone that you associate with a VPC, Resolver creates a rule and associates it with the VPC. If you associate the private hosted zone with multiple VPCs, Resolver associates the rule with the same VPCs.<br />
The rule has a type of <strong>Forward</strong>.</p>
<p><strong>Rules for various AWS internal domain names</strong><br />
All rules for the internal domain names in this section have a type of <strong>Forward</strong>. Resolver forwards DNS queries for these domain names to the authoritative name servers for the VPC.<br />
Resolver creates most of these rules when you set the <code>enableDnsHostnames</code> flag for a VPC to <code>true</code>. Resolver creates the rules even if you aren’t using Resolver endpoints. Resolver creates the following autodefined rules and associates them with a VPC when you set the <code>enableDnsHostnames</code> flag for the VPC to <code>true</code>:<br />
+ <em>Region-name</em>.compute.internal, for example, eu-west-1.compute.internal. The us-east-1 Region doesn’t use this domain name. + <em>Region-name</em>.compute.<em>amazon-domain-name</em>, for example, eu-west-1.compute.amazonaws.com or cn-north-1.compute.amazonaws.com.cn. The us-east-1 Region doesn’t use this domain name. + ec2.internal. Only the us-east-1 Region uses this domain name. + compute-1.internal. Only the us-east-1 Region uses this domain name. + compute-1.amazonaws.com. Only the us-east-1 Region uses this domain name. The following autodefined rules are for the reverse DNS lookup for the rules that Resolver creates when you set the <code>enableDnsHostnames</code> flag for the VPC to <code>true</code>.<br />
+ 10.in-addr.arpa + 16.172.in-addr.arpa through 31.172.in-addr.arpa + 168.192.in-addr.arpa + 254.169.254.169.in-addr.arpa + Rules for each of the CIDR ranges for the VPC. For example, if a VPC that has a CIDR range of 10.0.0.0/23, Resolver creates the following rules: + 0.0.10.in-addr.arpa + 1.0.10.in-addr.arpa The following autodefined rules, for localhost-related domains, also are created and associated with a VPC when you set the <code>enableDnsHostnames</code> flag for the VPC to <code>true</code>:<br />
+ localhost + localdomain + 127.in-addr.arpa + 1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa + 0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa Resolver creates the following autodefined rules and associates them with your VPC when you connect the VPC with another VPC through transit gateway or VPC peering, and with DNS support enabled:<br />
+ The reverse DNS lookup for the peer VPC’s IP address ranges, for example, 0.192.in-addr.arpa</p>
<p>If you add an IPv4 CIDR block to a VPC, Resolver adds an autodefined rule for the new IP address range. + If the other VPC is in another Region, the following domain names: + <em>Region-name</em>.compute.internal. The us-east-1 Region doesn’t use this domain name. + <em>Region-name</em>.compute.<em>amazon-domain-name</em>. The us-east-1 Region doesn’t use this domain name. + ec2.internal. Only the us-east-1 Region uses this domain name. + compute-1.amazonaws.com. Only the us-east-1 Region uses this domain name.</p>
<p><strong>A rule for all other domains</strong><br />
Resolver creates a “.” (dot) rule that applies to all domain names that aren’t specified earlier in this topic. The “.” rule has a type of <strong>Recursive</strong>, which means that the rule causes Resolver to act as a recursive resolver.</p>
<h2 id="considerations-when-creating-inbound-and-outbound-endpoints">Considerations when creating inbound and outbound endpoints<a name="resolver-choose-vpc"></a></h2>
<p>Before you create inbound and outbound Resolver endpoints in an AWS Region, consider the following issues.</p>
<p><strong>Topics</strong> + <a href="#resolver-considerations-number-of-endpoints">Number of inbound and outbound endpoints in each Region</a> + <a href="#resolver-considerations-same-vpc-inbound-outbound">Using the same VPC for inbound and outbound endpoints</a> + <a href="#resolver-considerations-inbound-endpoint-private-zone">Inbound endpoints and private hosted zones</a> + <a href="#resolver-considerations-vpc-peering">VPC peering</a> + <a href="#resolver-considerations-shared-subnets">IP addresses in shared subnets</a> + <a href="#resolver-considerations-connection-between-network-and-vpcs">Connection between your network and the VPCs that you create endpoints in</a> + <a href="#resolver-considerations-share-rules-share-outbound-endpoints">When you share rules, you also share outbound endpoints</a> + <a href="#resolver-considerations-dedicated-instance-tenancy">Using Resolver in VPCs that are configured for dedicated instance tenancy</a></p>
<p><strong>Number of inbound and outbound endpoints in each AWS Region</strong><br />
When you want to integrate DNS for the VPCs in an AWS Region with DNS for your network, you typically need one Resolver inbound endpoint (for DNS queries that you’re forwarding to your VPCs) and one outbound endpoint (for queries that you’re forwarding from your VPCs to your network). You can create multiple inbound endpoints and multiple outbound endpoints, but one inbound or outbound endpoint is sufficient to handle the DNS queries for each respective direction. Note the following:<br />
+ For each Resolver endpoint, you specify two or more IP addresses in different Availability Zones. Each IP address in an endpoint can handle a large number of DNS queries per second. (For the current maximum number of queries per second per IP address in an endpoint, see <a href="DNSLimitations.html#limits-api-entities-resolver">Quotas on Route 53 Resolver</a>.) If you need Resolver to handle more queries, you can add more IP addresses to your existing endpoint instead of adding another endpoint. + Resolver pricing is based on the number of IP addresses in your endpoints and on the number of DNS queries that the endpoint processes. Each endpoint includes a minimum of two IP addresses. For more information about Resolver pricing, see <a href="https://aws.amazon.com/route53/pricing/">Amazon Route 53 Pricing</a>. + Each rule specifies the outbound endpoint that DNS queries are forwarded from. If you create multiple outbound endpoints in an AWS Region and you want to associate some or all Resolver rules with every VPC, you need to create multiple copies of those rules.</p>
<p><strong>Using the same VPC for inbound and outbound endpoints</strong><br />
You can create inbound and outbound endpoints in the same VPC or in different VPCs in the same Region.<br />
For more information, see <a href="best-practices.html">Best practices for Amazon Route 53</a>.</p>
<p><strong>Inbound endpoints and private hosted zones</strong><br />
If you want Resolver to resolve inbound DNS queries using records in a private hosted zone, associate the private hosted zone with the VPC that you created the inbound endpoint in. For information about associating private hosted zones with VPCs, see <a href="hosted-zones-private.html">Working with private hosted zones</a>.</p>
<p><strong>VPC peering</strong><br />
You can use any VPC in an AWS Region for an inbound or an outbound endpoint regardless of whether the VPC that you choose is peered with other VPCs. For more information, see <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html">Amazon Virtual Private Cloud VPC peering</a>.</p>
<p><strong>IP addresses in shared subnets</strong><br />
When you create an inbound or outbound endpoint, you can specify an IP address in a shared subnet only if the current account created the VPC. If another account creates a VPC and shares a subnet in the VPC with your account, you can’t specify an IP address in that subnet. For more information about shared subnets, see <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-sharing.html">Working with shared VPCs</a> in the <em>Amazon VPC User Guide</em>.</p>
<p><strong>Connection between your network and the VPCs that you create endpoints in</strong><br />
You must have one of the following connections between your network and the VPCs that you create endpoints in:<br />
+ <strong>Inbound endpoints</strong> – You must set up either an <a href="https://docs.aws.amazon.com/directconnect/latest/UserGuide/Welcome.html">AWS Direct Connect</a> connection or a <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpn-connections.html">VPN connection</a> between your network and each VPC that you create an inbound endpoint for. + <strong>Outbound endpoints</strong> – You must set up an <a href="https://docs.aws.amazon.com/directconnect/latest/UserGuide/Welcome.html">AWS Direct Connect</a> connection, a <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpn-connections.html">VPN connection</a>, or a <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html">network address translation (NAT) gateway</a> between your network and each VPC that you create an outbound endpoint for.</p>
<p><strong>When you share rules, you also share outbound endpoints</strong><br />
When you create a rule, you specify the outbound endpoint that you want Resolver to use to forward DNS queries to your network. If you share the rule with another AWS account, you also indirectly share the outbound endpoint that you specify in the rule. If you used more than one AWS account to create VPCs in an AWS Region, you can do the following:<br />
+ Create one outbound endpoint in the Region. + Create rules using one AWS account. + Share the rules with all the AWS accounts that created VPCs in the Region. This allows you to use one outbound endpoint in a Region to forward DNS queries to your network from multiple VPCs even if the VPCs were created using different AWS accounts.</p>
<p><strong>Using Resolver in VPCs that are configured for dedicated instance tenancy</strong><br />
When you create a Resolver endpoint, you can’t specify a VPC that has the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/dedicated-instance.html">instance tenancy attribute</a> set to <code>dedicated</code>. Resolver doesn’t run on single-tenant hardware.<br />
You can still use Resolver to resolve DNS queries that originate in a VPC. Create at least one VPC that has the instance tenancy attribute set to <code>default</code>, and specify that VPC when you create inbound and outbound endpoints.<br />
When you create a forwarding rule, you can associate it with any VPC, regardless of the setting for the instance tenancy attribute.</p>
</body>
</html>
